<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- com.green.board.mapper -->
<mapper namespace="com.green.board.mapper.BoardMapper">
		 
	<insert id="insertBoard"  parameterType="BoardDTO">
		INSERT INTO board(writer,subject,writerPw,content,id) 
		VALUES(#{writer},#{subject},#{writerPw},#{content},#{id})
	</insert>	 

    <select id="getAllBoard" resultType="BoardDTO">
       SELECT *  FROM board ORDER BY num DESC
    </select>
    
    <!-- 게시글을 클릭하면 조회수 1씩 증가 -->
    <update id="upReadCount" parameterType="int">
       UPDATE board SET readcount = readcount + 1 WHERE num=#{num}
    </update>
    
    <select id="getOneBoard" parameterType="int" 
     resultType="BoardDTO">
        SELECT * FROM board WHERE num = #{num}
     </select>
     
     <!-- 게시글 하나를 수정 SQL -->
     <update id="updateBoard" parameterType="BoardDTO">
       UPDATE board SET subject=#{subject}, content=#{content}
       WHERE num=#{num} AND writerPw=#{writerPw}
     </update>
     
     <!-- @Param("num") int num, @Param("writerPw") String writerPw
          매퍼에서 파라미터로 매개변수 값을 받은 경우 SQL문에서 매개변수 생략한다.
       -->
     <delete id="deleteBoard">
       DELETE FROM board WHERE num=#{num} AND writerPw=#{writerPw}
     </delete>
     
     <!-- 검색
     	@Param("searchType") String searchType, 
		@Param("searchKeyword") String searchKeyword)
       -->
     <select id="getSearchBoard" resultType="BoardDTO">
       SELECT * FROM board
       <where>
          <choose>
          <!-- <when test="조건식 => a == b" > -->
          	<when test="searchType == 'subject'">
          		subject LIKE CONCAT("%", #{searchKeyword} , "%")
          	</when>
          	<otherwise>
          		content LIKE CONCAT("%", #{searchKeyword} , "%")
          	</otherwise>
          </choose>
       </where>
        ORDER BY num DESC
     </select>
     
     
     
    
    
</mapper>